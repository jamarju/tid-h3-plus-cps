<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tidradio H3 Plus - Web CPS</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <h1>Tidradio H3 Plus CPS</h1>
            <span class="connection-status" id="connectionStatus">Disconnected</span>
        </div>
        <div class="header-actions">
            <button id="btnConnect" class="btn btn-primary">Connect</button>
            <button id="btnRead" class="btn" disabled>Read</button>
            <button id="btnWrite" class="btn" disabled>Write</button>
            <div class="separator"></div>
            <button id="btnLoad" class="btn">Load File</button>
            <button id="btnSave" class="btn">Save File</button>
        </div>
    </header>

    <nav class="tabs">
        <button class="tab active" data-tab="channels">Channels</button>
        <button class="tab" data-tab="settings">Settings</button>
        <button class="tab" data-tab="debug">Debug</button>
    </nav>

    <main class="main-content">
        <section id="channelsPanel" class="panel active">
            <div class="grid-toolbar">
                <span class="grid-info">199 Channels | Arrow keys to navigate | Enter to edit | Ctrl+C/V copy/paste | Ctrl+1/2/3 switch tabs</span>
            </div>
            <div class="grid-container" id="gridContainer">
                <table class="channel-grid" id="channelGrid">
                    <thead>
                        <tr>
                            <th class="col-ch" title="Channel number (1-199)">CH</th>
                            <th class="col-rxfreq" title="Receive frequency in MHz - the frequency you listen on">RX Freq</th>
                            <th class="col-txfreq" title="Transmit frequency in MHz - the frequency you transmit on (same as RX for simplex)">TX Freq</th>
                            <th class="col-hop" title="Frequency Hopping - enables spread spectrum hopping (both radios must match)">Hop</th>
                            <th class="col-decode" title="RX CTCSS/DCS tone - only opens squelch when this tone is received (privacy code)">Decode(RX)</th>
                            <th class="col-encode" title="TX CTCSS/DCS tone - transmits this tone so others with matching Decode can hear you">Encode(TX)</th>
                            <th class="col-power" title="Transmit power: LOW (~1W) for short range/battery saving, HIGH (~5W) for longer range">Power</th>
                            <th class="col-bw" title="Bandwidth: N=Narrow (12.5kHz) for digital/PMR446, W=Wide (25kHz) for analog amateur">BW</th>
                            <th class="col-busy" title="Busy Channel Lockout - prevents transmitting when channel is in use">Busy</th>
                            <th class="col-pttid" title="PTT ID - sends DTMF identification when you press/release PTT">PTT ID</th>
                            <th class="col-scan" title="Include this channel in scan list when scanning">Scan</th>
                            <th class="col-name" title="Channel name (up to 8 characters) displayed on radio screen">Name</th>
                            <th class="col-scramble" title="Voice scrambling - both radios must have same setting to communicate">Scram</th>
                        </tr>
                    </thead>
                    <tbody id="channelBody">
                    </tbody>
                </table>
            </div>
        </section>

        <section id="settingsPanel" class="panel">
            <div class="settings-container" id="settingsContainer">
                <div class="settings-group">
                    <h3>Display</h3>
                    <div class="setting-row">
                        <label for="display">Display [15]</label>
                        <select id="display">
                            <option value="0">Single</option>
                            <option value="1">Dual</option>
                            <option value="2">Classic</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="lightControl">Backlight [12]</label>
                        <select id="lightControl">
                            <option value="0">Always On</option>
                            <option value="1">5S</option>
                            <option value="2">10S</option>
                            <option value="3">15S</option>
                            <option value="4">30S</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="brightness">Brightness [13]</label>
                        <select id="brightness">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="aChannelDisp">Display Type-A [17]</label>
                        <select id="aChannelDisp">
                            <option value="0">Freq + Number</option>
                            <option value="1">Name + Number</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="bChannelDisp">Display Type-B [18]</label>
                        <select id="bChannelDisp">
                            <option value="0">Freq + Number</option>
                            <option value="1">Name + Number</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="menuColor">Menu Color [42]</label>
                        <select id="menuColor">
                            <option value="0">Blue</option>
                            <option value="1">Red</option>
                            <option value="2">Green</option>
                            <option value="3">Yellow</option>
                            <option value="4">Purple</option>
                            <option value="5">Orange</option>
                            <option value="6">Light Blue</option>
                            <option value="7">Cyan</option>
                            <option value="8">Gray</option>
                            <option value="9">Dark Blue</option>
                            <option value="10">Light Green</option>
                            <option value="11">Brown</option>
                            <option value="12">Pink</option>
                            <option value="13">B.Red</option>
                            <option value="14">G.Blue</option>
                            <option value="15">L.Gray</option>
                            <option value="16">LG.Blue</option>
                            <option value="17">LB.Blue</option>
                        </select>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Audio</h3>
                    <div class="setting-row">
                        <label for="squelchLevel">Squelch Level [1]</label>
                        <select id="squelchLevel">
                            <option value="0">OFF</option>
                            <option value="1">Level 1</option>
                            <option value="2">Level 2</option>
                            <option value="3">Level 3</option>
                            <option value="4">Level 4</option>
                            <option value="5">Level 5</option>
                            <option value="6">Level 6</option>
                            <option value="7">Level 7</option>
                            <option value="8">Level 8</option>
                            <option value="9">Level 9</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="voicePrompt">Voice [11]</label>
                        <input type="checkbox" id="voicePrompt">
                    </div>
                    <div class="setting-row">
                        <label for="language">Language [21]</label>
                        <select id="language">
                            <option value="0">English</option>
                            <option value="1">Chinese</option>
                            <option value="2">Turkish</option>
                            <option value="3">Russian</option>
                            <option value="4">German</option>
                            <option value="5">Spanish</option>
                            <option value="6">Italian</option>
                            <option value="7">French</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="beep">Keypad Beep [7]</label>
                        <input type="checkbox" id="beep">
                    </div>
                    <div class="setting-row">
                        <label for="roger">Roger Beep [6]</label>
                        <select id="roger">
                            <option value="0">OFF</option>
                            <option value="1">TONE1</option>
                            <option value="2">TONE2</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="micGain">[33] MIC Gain</label>
                        <select id="micGain">
                            <option value="0">00</option>
                            <option value="1">01</option>
                            <option value="2">02</option>
                            <option value="3">03</option>
                            <option value="4">04</option>
                            <option value="5">05</option>
                            <option value="6">06</option>
                            <option value="7">07</option>
                            <option value="8">08</option>
                            <option value="9">09</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="rTone">R-TONE</label>
                        <select id="rTone">
                            <option value="0">1000Hz</option>
                            <option value="1">1450Hz</option>
                            <option value="2">1750Hz</option>
                            <option value="3">2100Hz</option>
                        </select>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Signal</h3>
                    <div class="setting-row">
                        <label for="ste">STE [23]</label>
                        <input type="checkbox" id="ste">
                    </div>
                    <div class="setting-row">
                        <label for="toneBurst">Tone Burst [24]</label>
                        <select id="toneBurst">
                            <option value="0">1000Hz</option>
                            <option value="1">1450Hz</option>
                            <option value="2">1750Hz</option>
                            <option value="3">2100Hz</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="talkAround">Talk Around [25]</label>
                        <input type="checkbox" id="talkAround">
                    </div>
                    <div class="setting-row">
                        <label for="fmInterrupt">FM Interrupt [26]</label>
                        <input type="checkbox" id="fmInterrupt">
                    </div>
                </div>

                <div class="settings-group">
                    <h3>TX Settings</h3>
                    <div class="setting-row">
                        <label for="stepFreq">Step Freq [2]</label>
                        <select id="stepFreq">
                            <option value="0">2.5K</option>
                            <option value="1">5.0K</option>
                            <option value="2">6.25K</option>
                            <option value="3">10K</option>
                            <option value="4">12.5K</option>
                            <option value="5">25K</option>
                            <option value="6">50K</option>
                            <option value="7">0.5K</option>
                            <option value="8">8.33K</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="tot">TOT [5]</label>
                        <select id="tot">
                            <option value="0">OFF</option>
                            <option value="1">30S</option>
                            <option value="2">60S</option>
                            <option value="3">90S</option>
                            <option value="4">120S</option>
                            <option value="5">150S</option>
                            <option value="6">180S</option>
                            <option value="7">210S</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="pttDelay">PTT Delay [20]</label>
                        <select id="pttDelay">
                            <option value="0">100ms</option>
                            <option value="1">200ms</option>
                            <option value="2">300ms</option>
                            <option value="3">400ms</option>
                            <option value="4">500ms</option>
                            <option value="5">600ms</option>
                            <option value="6">700ms</option>
                            <option value="7">800ms</option>
                            <option value="8">900ms</option>
                            <option value="9">1000ms</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="modulation">Modulation [38]</label>
                        <select id="modulation">
                            <option value="0">FM</option>
                            <option value="1">AM</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="tx200">200Tx [39]</label>
                        <input type="checkbox" id="tx200">
                    </div>
                    <div class="setting-row">
                        <label for="tx350">350Tx [40]</label>
                        <input type="checkbox" id="tx350">
                    </div>
                    <div class="setting-row">
                        <label for="tx500">500Tx [41]</label>
                        <input type="checkbox" id="tx500">
                    </div>
                </div>

                <div class="settings-group">
                    <h3>VOX</h3>
                    <div class="setting-row">
                        <label for="voxGain">VOX Level [3]</label>
                        <select id="voxGain">
                            <option value="0">OFF</option>
                            <option value="1">Level 1</option>
                            <option value="2">Level 2</option>
                            <option value="3">Level 3</option>
                            <option value="4">Level 4</option>
                            <option value="5">Level 5</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="voxDelay">VOX Delay [4]</label>
                        <select id="voxDelay">
                            <option value="0">1.0S</option>
                            <option value="1">2.0S</option>
                            <option value="2">3.0S</option>
                        </select>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Scan</h3>
                    <div class="setting-row">
                        <label for="tdr">Dual Watch [10]</label>
                        <input type="checkbox" id="tdr">
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Power Save</h3>
                    <div class="setting-row">
                        <label for="save">Power Save [8]</label>
                        <select id="save">
                            <option value="0">OFF</option>
                            <option value="1">Level 1 (1:1)</option>
                            <option value="2">Level 2 (1:2)</option>
                            <option value="3">Level 3 (1:3)</option>
                            <option value="4">Level 4 (1:4)</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="autoLock">Keypad Lock [9]</label>
                        <input type="checkbox" id="autoLock">
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Function Keys</h3>
                    <div class="setting-row">
                        <label for="shortKeyPf1">[27] PF1 Short Press</label>
                        <select id="shortKeyPf1" class="key-select"></select>
                    </div>
                    <div class="setting-row">
                        <label for="longKeyPf1">[28] PF1 Long Press</label>
                        <select id="longKeyPf1" class="key-select"></select>
                    </div>
                    <div class="setting-row">
                        <label for="shortKeyPf2">[29] PF2 Short Press</label>
                        <select id="shortKeyPf2" class="key-select"></select>
                    </div>
                    <div class="setting-row">
                        <label for="longKeyPf2">[30] PF2 Long Press</label>
                        <select id="longKeyPf2" class="key-select"></select>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Alarm</h3>
                    <div class="setting-row">
                        <label for="alarmMode">Alarm Mode [22]</label>
                        <select id="alarmMode">
                            <option value="0">On Site</option>
                            <option value="2">TX Alarm</option>
                        </select>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>DTMF</h3>
                    <div class="setting-row">
                        <label for="aniEdit">ANI-Edit [16]</label>
                        <input type="text" id="aniEdit" maxlength="3" class="text-input" pattern="[0-9]{3}" placeholder="000">
                    </div>
                    <div class="setting-row">
                        <label for="dtmfSideTone">DTMF Side Tone [19]</label>
                        <input type="checkbox" id="dtmfSideTone">
                    </div>
                    <div class="setting-row">
                        <label for="dtmfSpeed">DTMF Speed [34]</label>
                        <select id="dtmfSpeed">
                            <option value="0">80ms</option>
                            <option value="1">90ms</option>
                            <option value="2">100ms</option>
                            <option value="3">110ms</option>
                            <option value="4">120ms</option>
                            <option value="5">130ms</option>
                            <option value="6">140ms</option>
                            <option value="7">150ms</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="dDcd">DCD [35]</label>
                        <input type="checkbox" id="dDcd">
                    </div>
                    <div class="setting-row">
                        <label for="dHold">D-HOLD [36]</label>
                        <select id="dHold">
                            <option value="0">OFF</option>
                            <option value="1">5S</option>
                            <option value="2">10S</option>
                            <option value="3">15S</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="dRsp">D-RSP [37]</label>
                        <select id="dRsp">
                            <option value="0">NULL</option>
                            <option value="1">RING</option>
                            <option value="2">REPLY</option>
                            <option value="3">BOTH</option>
                        </select>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>LED</h3>
                    <div class="setting-row">
                        <label for="breathLed">Breath LED [32]</label>
                        <select id="breathLed">
                            <option value="0">OFF</option>
                            <option value="1">5s</option>
                            <option value="2">10s</option>
                            <option value="3">15s</option>
                            <option value="4">30s</option>
                        </select>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Power On Message</h3>
                    <div class="setting-row">
                        <label for="ponmgs">PONMGS</label>
                        <select id="ponmgs">
                            <option value="0">OFF</option>
                            <option value="1">MSG</option>
                            <option value="2">Voltage</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="msg1">MSG1</label>
                        <input type="text" id="msg1" maxlength="16" class="text-input">
                    </div>
                    <div class="setting-row">
                        <label for="msg2">MSG2</label>
                        <input type="text" id="msg2" maxlength="16" class="text-input">
                    </div>
                    <div class="setting-row">
                        <label for="msg3">MSG3</label>
                        <input type="text" id="msg3" maxlength="16" class="text-input">
                    </div>
                </div>
            </div>
        </section>

        <section id="debugPanel" class="panel">
            <div class="debug-toolbar">
                <span class="debug-info">Memory Dump (16 KB) | <span class="legend-known">Known</span> <span class="legend-unknown">Unknown Data</span> <span class="legend-empty">Empty (0xFF)</span> | Ctrl+1/2/3 switch tabs</span>
            </div>
            <div class="debug-container" id="debugContainer">
                <div class="hexdump" id="hexdump">
                    <div class="hexdump-placeholder">Read from radio to view memory dump</div>
                </div>
            </div>
        </section>
    </main>

    <footer class="status-bar">
        <span id="statusMessage">Ready</span>
        <div class="progress-container" id="progressContainer" style="display: none;">
            <div class="progress-bar" id="progressBar"></div>
        </div>
    </footer>

    <input type="file" id="fileInput" accept=".json,.h3p" style="display: none;">

    <script src="js/storage.js"></script>
    <script src="js/ble.js"></script>
    <script src="js/grid.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/debug.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
